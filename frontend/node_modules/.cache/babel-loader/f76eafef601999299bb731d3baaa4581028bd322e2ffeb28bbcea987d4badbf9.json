{"ast":null,"code":"import React from'react';import{useState,useEffect,useRef}from'react';import{Link,useParams}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function MemoPaper(){const{year,month,day}=useParams();const[meal,setMeal]=useState('');const[exercise,setExercise]=useState('');const[hospital,setHospital]=useState('');const[other,setOther]=useState('');const[weight,setWeight]=useState('');const token=localStorage.getItem('token');const isComposing=useRef(false);const fetchMemo=async()=>{try{const response=await fetch(\"http://127.0.0.1:8000/users/healthcare/get?year=\".concat(year,\"&month=\").concat(month,\"&day=\").concat(day),{headers:{'Authorization':\"Bearer \".concat(token)}});if(!response.ok)throw new Error('データの取得に失敗しました。');const data=await response.json();setMeal(data.meal||'');setExercise(data.exercise||'');setHospital(data.hospital||'');setOther(data.other||'');setWeight(data.weight||'');}catch(error){alert(error.message);}};const handleSave=async()=>{try{const response=await fetch('http://127.0.0.1:8000/users/healthcare/save',{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify({year:Number(year),month:Number(month),day:Number(day),meal,exercise,hospital,other,weight})});if(!response.ok)throw new Error('保存に失敗しました。');}catch(error){alert(error.message);}};// 入力された全角数字を半角数字にする関数\nconst toHalfWidthNumber=value=>{/* /.../は正規表現\r\n           今回は全角０～９までの数字のすべてを指定\r\n         */let formatteValue=value.replace(/[０-９．]/g,s=>{/* 0xFEE0は10進数にすると65248であり\r\n                これはUnicdeでの全角文字と半角文字の差である\r\n                つまりs.charCodeAtで文字をUnicodeの番号に変換し\r\n                全角文字と半角文字の差を引き半角文字のUnicodeにして\r\n                String.fromCharCodeでUnicodeの番号を文字に戻す */if(s==='．')return'.';return String.fromCharCode(s.charCodeAt(0)-0xFEE0);});formatteValue=formatteValue.replace(/[^0-9.]/g,'');return formatteValue;};const handleChangeWeightText=e=>{if(isComposing.current){setWeight(e.target.value);}else{const value=toHalfWidthNumber(e.target.value);setWeight(value);}};const handleConversionStart=()=>{isComposing.current=true;};const handleConversionEnd=e=>{isComposing.current=false;handleChangeWeightText(e);};useEffect(()=>{fetchMemo();},[year,month,day]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Link,{className:\"back-calender\",to:\"/calender\",children:\"\\u30AB\\u30EC\\u30F3\\u30C0\\u30FC\\u306B\\u623B\\u308B\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"current-date\",children:[year,\"\\u5E74\",month,\"\\u6708\",day,\"\\u65E5\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"memo-paper\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"meal\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\uFF1C\\u98DF\\u4E8B\\uFF1E\"}),/*#__PURE__*/_jsx(\"textarea\",{value:meal,onChange:e=>setMeal(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"exercise\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\uFF1C\\u904B\\u52D5\\uFF1E\"}),/*#__PURE__*/_jsx(\"textarea\",{value:exercise,onChange:e=>setExercise(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"hospital\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\uFF1C\\u75C5\\u9662\\uFF1E\"}),/*#__PURE__*/_jsx(\"textarea\",{value:hospital,onChange:e=>setHospital(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"other\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\uFF1C\\u305D\\u306E\\u4ED6\\uFF1E\"}),/*#__PURE__*/_jsx(\"textarea\",{value:other,onChange:e=>setOther(e.target.value)})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"weight\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\uFF1C\\u4F53\\u91CD\\uFF1E\\uFF08\\u534A\\u89D2\\u6570\\u5B57\\uFF09\"}),/*#__PURE__*/_jsx(\"textarea\",{value:weight,onChange:handleChangeWeightText,onCompositionStart:handleConversionStart,onCompositionEnd:handleConversionEnd}),/*#__PURE__*/_jsx(\"span\",{children:\" kg\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"save-btn\",children:/*#__PURE__*/_jsx(\"button\",{onClick:handleSave,children:\"\\u4FDD\\u5B58\"})})]});}export default MemoPaper;","map":{"version":3,"names":["React","useState","useEffect","useRef","Link","useParams","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","MemoPaper","year","month","day","meal","setMeal","exercise","setExercise","hospital","setHospital","other","setOther","weight","setWeight","token","localStorage","getItem","isComposing","fetchMemo","response","fetch","concat","headers","ok","Error","data","json","error","alert","message","handleSave","method","body","JSON","stringify","Number","toHalfWidthNumber","value","formatteValue","replace","s","String","fromCharCode","charCodeAt","handleChangeWeightText","e","current","target","handleConversionStart","handleConversionEnd","children","className","to","onChange","onCompositionStart","onCompositionEnd","onClick"],"sources":["C:/Users/ayuto/github/health-care-application/frontend/src/compornent/MemoPaper.js"],"sourcesContent":["import React from 'react';\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { Link, useParams } from 'react-router-dom';\r\n\r\nfunction MemoPaper() {\r\n    const { year, month, day } = useParams();\r\n    const [meal, setMeal] = useState('');\r\n    const [exercise, setExercise] = useState('');\r\n    const [hospital, setHospital] = useState('');\r\n    const [other, setOther] = useState('');\r\n    const [weight, setWeight] = useState('');\r\n    const token = localStorage.getItem('token');\r\n    const isComposing = useRef(false);\r\n\r\n    const fetchMemo = async() => {\r\n        try {\r\n            const response = await fetch(`http://127.0.0.1:8000/users/healthcare/get?year=${year}&month=${month}&day=${day}`, {\r\n                headers: {'Authorization': `Bearer ${token}`}\r\n            });\r\n            if(!response.ok) throw new Error('データの取得に失敗しました。');\r\n            const data = await response.json();\r\n            setMeal(data.meal || '');\r\n            setExercise(data.exercise || '');\r\n            setHospital(data.hospital || '');\r\n            setOther(data.other || '');\r\n            setWeight(data.weight || '');\r\n        } catch (error) {\r\n            alert(error.message);\r\n        }\r\n    };\r\n\r\n    const handleSave = async() => {\r\n        try {\r\n            const response = await fetch('http://127.0.0.1:8000/users/healthcare/save', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`\r\n                },\r\n                body: JSON.stringify({\r\n                    year: Number(year),\r\n                    month: Number(month), \r\n                    day: Number(day),\r\n                    meal, exercise, hospital, other, weight,\r\n                }),\r\n            });\r\n            if (!response.ok) throw new Error('保存に失敗しました。');\r\n        } catch (error) {\r\n            alert(error.message);\r\n        }\r\n\r\n    }\r\n\r\n    // 入力された全角数字を半角数字にする関数\r\n    const toHalfWidthNumber = (value) => {\r\n        /* /.../は正規表現\r\n           今回は全角０～９までの数字のすべてを指定\r\n         */\r\n        let formatteValue = value.replace(/[０-９．]/g, (s) => {\r\n                /* 0xFEE0は10進数にすると65248であり\r\n                これはUnicdeでの全角文字と半角文字の差である\r\n                つまりs.charCodeAtで文字をUnicodeの番号に変換し\r\n                全角文字と半角文字の差を引き半角文字のUnicodeにして\r\n                String.fromCharCodeでUnicodeの番号を文字に戻す */\r\n                if (s === '．') return '.'; \r\n                return String.fromCharCode(s.charCodeAt(0) - 0xFEE0)\r\n            });\r\n        formatteValue = formatteValue.replace(/[^0-9.]/g, '');\r\n        return formatteValue\r\n    };\r\n    const handleChangeWeightText = (e) => {\r\n        if (isComposing.current) {\r\n            setWeight(e.target.value);\r\n        } else {\r\n            const value = toHalfWidthNumber(e.target.value);\r\n            setWeight(value);\r\n        }\r\n    };\r\n    const handleConversionStart = () => {\r\n        isComposing.current = true;\r\n    };\r\n    const handleConversionEnd = (e) => {\r\n        isComposing.current = false;\r\n        handleChangeWeightText(e);\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchMemo();\r\n    }, [year, month, day]);\r\n\r\n    return (\r\n        <>\r\n            <Link className='back-calender' to=\"/calender\">カレンダーに戻る</Link>\r\n            <p className='current-date'>{year}年{month}月{day}日</p>\r\n            <div className='memo-paper'>\r\n                <div>\r\n                    <div className='meal'>\r\n                    <p>＜食事＞</p>\r\n                    <textarea value={meal} onChange={(e) => setMeal(e.target.value)}></textarea>\r\n                    </div>\r\n                    <div className='exercise'>\r\n                        <p>＜運動＞</p>\r\n                        <textarea value={exercise} onChange={(e) => setExercise(e.target.value)}></textarea>\r\n                    </div>\r\n                    <div className='hospital'>\r\n                        <p>＜病院＞</p>\r\n                        <textarea value={hospital} onChange={(e) => setHospital(e.target.value)}></textarea>\r\n                    </div>\r\n                    <div className='other'>\r\n                        <p>＜その他＞</p>\r\n                        <textarea value={other} onChange={(e) => setOther(e.target.value)}></textarea>\r\n                    </div>\r\n                </div>\r\n                <div className='weight'>\r\n                    <p>＜体重＞（半角数字）</p>\r\n                    <textarea \r\n                    value={weight} \r\n                    onChange={handleChangeWeightText}\r\n                    onCompositionStart={handleConversionStart}\r\n                    onCompositionEnd={handleConversionEnd}\r\n                    ></textarea><span> kg</span>\r\n                </div>\r\n            </div>\r\n            <div className='save-btn'>\r\n                <button onClick={handleSave}>保存</button>\r\n            </div>\r\n        </>\r\n    )\r\n}\r\n\r\nexport default MemoPaper"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}